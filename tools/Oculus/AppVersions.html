<!DOCTYPE html>
<html>
    <head>
        <title>Oculus API App Versions</title>
        <meta property="og:site_name" content="ComputerElite">
        <meta property="og:title" content="Oculus API App Versions" />
        <meta property="og:description" content="A page to get downloads for various Oculus apps" />
        <meta property="og:url" content="https://computerelite.github.io/tools/Oculus/AppVersions.html" />
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
        <link href="../../css/standard.css" type="text/css" rel="stylesheet">
        <link rel="icon" href="../../assets/CE_64px.png" type="image/x-icon">
        <style>
            td {
                padding: 10px;
            }
    
            .item {
                flex: 1;
                width: 25%;
                word-wrap: break-word;
                padding: 3px;
            }
            </style>
    </head>
    <body>
        <div style="padding-top: 10px; width: 100%; display: flex;">
            <div style="flex: 1; background-color: #2F3136; padding: 10px;">
                <div style="font-size: 24px; text-align: center;">Oculus API App Versions</div>
                <div style="font-size: 15px; text-align: center; color: #888;">
                    Get download links for all Oculus Quest apps
                </div>

                <table style="padding: 10px; width: 700px; margin: auto; margin-top: 40px;">
                    <tr><td>Headset</td><td><select id="headset">
                        <option value="MONTEREY">Quest 1/2</option>
                        <option value="RIFT">Rift</option>
                    </select></td></tr>
                    <tr><td>Search term for app</td><td><input type="text" value="Beat Saber" id="searchTerm" spellcheck="false"></td><td><input type="button" value="Search" onclick="Search()"></td></tr>
                </table>
                <div id="resultContainer">
                    <div style="display: flex; flex-wrap: wrap;">
                        <div style="flex: 1; background-color: #222222; font-size: 18px; padding: 5px; margin: 5px;">
                            <table style="width: fit-content; margin: auto;">
                                <tr><td><img src="../../assets/CE_512px.png" width="100px" height="100px"></td><td>Please search</td></tr>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="guideHeader">Is this legal?</div>
                <div class="guideSteps">
                    I cannot give an 100% correct answer on that. But it uses Oculus public API and official download servers (for which you need to own the app and be logged in on <a href="https://www.oculus.com/">oculus.com</a> to download the app) to get all the information.
                    <br/>
                    So if you ask me I'd say yes, it is legal.
                </div>
                <br/>
                <div style="text-align: center; font-size: 11px; color: #888;">
                    API requests found by Lillie. Page by ComputerElite
                </div>
            </div>
        </div>
        <script src="../../js/standard.js"></script>
        <script>
            const versionSkeleton = `<div style="font-size: 22px; text-align: center; font-weight: bold;" id="versionHeader">Versions</div>
                    <div style="font-size: 18px; color: #EEEEEE; text-align: center; display: flex; justify-content: center; width: 100%;">
                        <div class="item">Version</div>
                        <div class="item">Changelog</div>
                        <div class="item">id</div>
                    </div>
                    <div id="versions" style="display: flex; color: #EEEEEE; width: 100%; justify-content: space-evenly; flex-direction: column;">

                    </div>`
            const storeSkeleton = `<div style="display: flex; flex-wrap: wrap;" id="apps">
                    </div>`

            function Search() {
                document.getElementById("resultContainer").innerHTML = storeSkeleton
                document.getElementById("apps").innerHTML = "requesting"
                PostRequest("https://graph.oculus.com/graphql", `access_token=OC|1317831034909742|&variables={"query":"${document.getElementById("searchTerm").value}","hmdType":"${document.getElementById("headset").value}","firstSearchResultItems":100}&doc_id=4446310405385365`).then((res) => {
                    res.data.viewer.contextual_search.all_category_results.forEach(cat => {
                        if(cat.name == "APPS") {
                            document.getElementById("apps").innerHTML = ""
                            cat.search_results.nodes.forEach(element => {
                                document.getElementById("apps").innerHTML += GetResultFormatted({
                                    imgsrc: element.target_object.cover_square_image.uri,
                                    name: element.target_object.display_name,
                                    id: element.target_object.id
                                })
                            })
                        }
                    })
                })
            }

            function SearchVersions(id) {
                document.getElementById("resultContainer").innerHTML = versionSkeleton
                document.getElementById("versions").innerHTML = "requesting"
                PostRequest("https://graph.oculus.com/graphql", `access_token=OC|1317831034909742|&variables={"id":"${id}"}&doc_id=1586217024733717`).then((res) => {
                    document.getElementById("versions").innerHTML = ""
                    document.getElementById("versionHeader").innerHTML = `Versions for ${res.data.node.displayName}`
                    res.data.node.supportedBinaries.edges.forEach(element => {
                        document.getElementById("versions").innerHTML += GetFormatted({
                            download: "https://securecdn.oculus.com/binaries/download/?id=" + element.node.id,
                            version: element.node.version,
                            changelog: element.node.changeLog,
                            id: element.node.id
                        }, res.data.node.displayName)
                    })
                })
            }

            

            function GetFormatted(element, app) {
                return `<a style="font-size: 16px; color: #EEEEEE; text-align: center; display: flex; width: 100%;" href="${element.download}" download="${app}_${element.version}">
                            <div class="item">${element.version}</div>
                            <div class="item">${element.changelog.replace("\n", "<br/>")}</div>
                            <div class="item">${element.id}</div>
                        </a>
                        <div style='width: 90%; margin-left: auto; margin-right: auto;'><hr></div>`
            }

            function GetResultFormatted(element) {
                return `<a style="flex: 1; background-color: #222222; font-size: 18px; padding: 5px; margin: 5px; cursor: pointer;" onclick="SearchVersions('${element.id}')">
                            <table style="width: fit-content; margin: auto;">
                                <tr><td><img src="${element.imgsrc}" width="100px" height="100px"></td><td>${element.name}</td></tr>
                            </table>
                        </a>`
            }

            function PostRequest(url, body) {
                return new Promise((resolve, reject) => {
                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", url, true);
                    xhr.onreadystatechange = () => {
                        if (xhr.readyState == XMLHttpRequest.DONE) {
                            resolve(JSON.parse(xhr.responseText))
                        }
                    }
                    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                    xhr.send(body);
                })
            }
        </script>
    </body>
</html>